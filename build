#!/usr/bin/env sh
set -ex # Stop on first error and log all commands

CC="cc"
CFLAGS="-Wall -Werror -Wextra -Wshadow -Wmissing-declarations -Wswitch-enum -pedantic -std=c99"

# Build libs
cd lib && $CC $CFLAGS -c *.c && cd ..

# Build and run tests
for src in $(ls test/*.t.c)
do
    name="$(basename -s .t.c "$src")"
    bin="test/$name.t"
    lib="lib/$name.o"
    $CC $CFLAGS -o "$bin" "$src" "$lib"
    "./$bin"
done

# Build main program
$CC $CFLAGS -o yupa main.c lib/*.o
